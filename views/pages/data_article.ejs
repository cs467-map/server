<h1 id="city-data">City Data</h1>
<p>Downloaded from natural earth.</p>
<p>Used <code>shp2pgsql</code> to convert the shapefile into a postgresql query/instert file. Used <code>psql -f thatfile.sql</code> to get it into a temp database</p>
<p>Created country table with</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">CREATE</span> <span class="kw">TABLE</span> country(<span class="kw">id</span> SERIAL <span class="kw">NOT</span> <span class="kw">NULL</span>, name <span class="dt">VARCHAR</span>(<span class="dv">100</span>), code <span class="dt">VARCHAR</span>(<span class="dv">3</span>));</a></code></pre></div>
<p>Inserted from DB with</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">INSERT</span> <span class="kw">INTO</span> country (name, code) <span class="kw">SELECT</span> DISTNICT(sov0name) <span class="kw">as</span> name, sov_a3 <span class="kw">as</span> code <span class="kw">FROM</span> temptable;</a></code></pre></div>
<p>Created city table with</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">CREATE</span> <span class="kw">TABLE</span> city (<span class="kw">id</span> SERIAL <span class="kw">NOT</span> <span class="kw">NULL</span>, name <span class="dt">VARCHAR</span>(<span class="dv">100</span>), country\_id</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="dt">INTEGER</span> <span class="kw">REFERENCES</span> country(<span class="kw">id</span>), lat <span class="dt">NUMERIC</span>, lng <span class="dt">NUMERIC</span>);</a></code></pre></div>
<p>Inserted with</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">INSERT</span> <span class="kw">INTO</span> city(name, country\_id, lat, lng) </a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">SELECT</span> temptable.name,c.<span class="kw">id</span>, latitude, longitude </a>
<a class="sourceLine" id="cb4-3" title="3"><span class="kw">FROM</span> temptable </a>
<a class="sourceLine" id="cb4-4" title="4"><span class="kw">JOIN</span> country <span class="kw">AS</span> c <span class="kw">ON</span> temptable.sov0name <span class="op">=</span> c.name;</a></code></pre></div>
<p>Copied these with <code>\copy (SELECT * FROM country)</code> to <code>'\Users\user\...\MyFileName.csv\' with csv</code></p>
<h1 id="beaches">Beaches</h1>
<p>Using coastline data from the natural earth site, I have created a table using <code>shp2pgsql</code>.</p>
<p>Then, I created a temp table from the city data, with postgis point geoms instead of lon/lat, using <code>ST_MakePoint(lon, lat)</code> Since this was actually wrong, and had no srid, I had to</p>
<p>Then, I merged these tables and used the <code>ST_DWithin</code> function from postgis with the following command:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">ALTER</span> <span class="kw">TABLE</span> st_setsrid</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw">ALTER</span> <span class="kw">TABLE</span> coastline</a>
<a class="sourceLine" id="cb5-3" title="3"><span class="kw">ALTER</span> <span class="kw">COLUMN</span> geom <span class="kw">TYPE</span> geometry(MULTILINESTRING, <span class="dv">4326</span>)</a>
<a class="sourceLine" id="cb5-4" title="4"><span class="kw">USING</span> ST_SetSRID(geom,<span class="dv">4326</span>)</a>
<a class="sourceLine" id="cb5-5" title="5"></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="kw">SELECT</span> <span class="kw">id</span>, ST_SetSRID(ST_MakePoint(lon, lat), <span class="dv">4326</span>) </a>
<a class="sourceLine" id="cb5-7" title="7"><span class="kw">INTO</span> <span class="kw">TABLE</span> citygeom <span class="kw">FROM</span> city;</a>
<a class="sourceLine" id="cb5-8" title="8"></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="kw">SELECT</span> <span class="kw">DISTINCT</span>(cg.<span class="kw">id</span>), <span class="fu">COALESCE</span>(ST_DWithin(cl.geom<span class="ch">:geography</span>, cg.st_setsrid:<span class="ch">:geography</span>, <span class="dv">80000</span>), <span class="kw">false</span>) </a>
<a class="sourceLine" id="cb5-10" title="10"><span class="kw">INTO</span> <span class="kw">TABLE</span> beaches <span class="kw">FROM</span> coastline cl </a>
<a class="sourceLine" id="cb5-11" title="11"><span class="kw">RIGHT</span> <span class="kw">JOIN</span> citygeom cg <span class="kw">ON</span> ST_DWithin(cl.geom:<span class="ch">:geography</span>, cg.st_setsrid:<span class="ch">:geography</span>, <span class="dv">80000</span>);</a></code></pre></div>
<p>80,000 references meters, which is roughly 50 miles. This is from city center to coastline, and since some travellers might be willing to drive further, I have decided to include all cities that could ‘reasonably’</p>
<p>What do you guys think about: town = less than 50k people, small city, less than 150k, city, less than 500k, large city, less than 2 million people, mega city, anything larger. What population breakdowns would you give? Similarly, for the coast line, what defines “close to beaches”? I filtered it to less than 50 miles to coast. Some friends I asked said 10 or 25 miles, but I dont think there is harm in showing cities that are 40 miles away, it could be a big drive, but not necessarily terrible. For mountains, there is no list of mountains I can find. So what defines mountain? I was going to go by elevation data, and say any region over 11,500 feet If you are looking for potential skiing cities, I think its further than beaches. I was going to set it to “Cities that are less than 80 miles from a region at least 11,500 ft”</p>
<p>Make sure you have postgis extention enabled in your database, CREATE EXTENSION postgis; 17:14 then you have to make a temp table where the lon/lat are replaced with geometries (technically geographies, but i havent gotten that far yet, so I just cast later) I use the projection 4326, because its pretty standard</p>
<p>Convert city points to geoms. SELECT id, ST_SetSRID(ST_MakePoint(lon, lat), 4326) INTO TABLE citygeom FROM city;</p>
<p>Then I would do something similar for airports, so you have airport id, and point (Side note, temp tables disappear after you close out of psql. If you want to do that, use INTO TEMP TABLE citygeom Then, once you have both that are points, you combine them into your perminent table that will have city id, and t/f for whether there is a close by airport SELECT DISTINCT(cg.id), COALESCE(ST_DWithin(cl.geom:geography, cg.st_setsrid::geography, 80000), false) INTO TABLE beaches FROM coastline cl RIGHT JOIN citygeom cg ON ST_DWithin(cl.geom::geography, cg.st_setsrid::geography, 80000); Thats the query I used. Note that you have to cast to geography for ST_DWithin to work properly, with the :: I actually missed it copying in the first one. but its table.geoAttribute::geography the 80,000 that I used is meters, thats 50 miles. I would make it much smaller than that like 10 max So like 16000 meters</p>
<p>Cool, well I have to strip this csv file I have down some and then Ill give that a go</p>
<p>So this: ‘SELECT DISTINCT(cg.id), COALESCE(ST_DWithin(cl.geom:geography, cg.st_setsrid::geography, 80000), false) INTO TABLE beaches FROM coastline cl RIGHT JOIN citygeom cg ON ST_DWithin(cl.geom::geography, cg.st_setsrid::geography, 80000);’</p>
<p>coalesce selects the first true statement, or the last one in this case, if the st_dwithin is true its true, otherwise false st_dwithin, i believe loops through them all and checks to see if there are city points within the distance specified for each airport point distance in meters.</p>
